引継ぎメモ（次チャット用）

【0. 現状サマリ（2026/02/05時点）】
- A01〜A06（人口〜主要言語数）に加えて、B01〜B03（国家体制／基礎自治体数／地方自治の強さ）まで **入力・表示実装とも完了**。
- 本プロジェクトは CSV が唯一の Source of Truth（SoT）。JavaScript（app.js）は CSV → UI 変換のみ（推測補完・国別例外ロジックを入れない）。
- UI 表示は `version` と `review_status` の完全一致フィルタが前提。CSV側の version/status 整合が最重要。

【1. 確定仕様（A01〜A06）】
- A01 人口：World Bank (WDI) `SP.POP.TOTL`。年は 2024 表記に統一。
- A02 都市化率：World Bank (WDI) `SP.URB.TOTL.IN.ZS`（都市の定義は国別）。年は 2024 表記に統一。
- A03 インターネット普及率：World Bank (WDI) `IT.NET.USER.ZS`。国ごとに latest（最新年）を採用。
- A04 スマホ普及率（代理指標）：World Bank (WDI) `IT.CEL.SETS.P2`（携帯契約数/100人）を代理として採用。
- A05 1人あたりGDP（PPP）：World Bank (WDI) `NY.GDP.PCAP.PP.CD`。表示は整数（四捨五入）＋カンマ区切り。
- A06 主要言語数：全国レベルの公用語数。de facto は明確な根拠がある場合のみカウント（推測禁止）。

【2. 確定仕様（B01〜B03）】
- B01 国家体制：main は `単一国家（Unitary）` / `連邦国家（Federal）` の2択固定。
  - UI色：単一→`nationwide`、連邦→`partial`。
- B02 基礎自治体数：main は整数。detail で「何を数えたか」を必ず明記。
  - UI表示：整数を3桁カンマで表示（CSVの main は整数のままで良い）。
  - 日本（JPN）：**1,741**（MICの municipalities 1,718 + 東京23区 23）。
  - 追記：JPN B02 の detail から「北方領土等…」の一文は削除済み（ユーザー要望）。
- B03 地方自治の強さ：main は `Strong/Medium/Weak` の3択固定。
  - detail はテンプレ順固定：`憲法上の保障：…／立法権の有無：…／制度上の位置づけ：…／裁量の制約要因：…`
  - UI色：Strong→`nationwide`、Medium→`partial`、Weak→`planned`。

【3. 反映済みファイルの扱い（重要）】
- `data/country_basic.csv` は置換ではなく **マージ（追加/上書き）**で更新する。
  - 置換キー：`country_id + basic_id + version + review_status`
- index の基本情報（抜粋）は `BASIC_SUMMARY_IDS` に列挙された basic_id のみ表示。
  - 現在のデフォルト：`A01..A06 + B01..B03`。

【4. 既知トラブルと対処（更新）】
(1) indexで「基本情報を表示」ボタンを押しても空
- 原因：`renderBasicSummary()` の実装崩れ（典型：`main` 定義前参照、`buildRankClassMap` にDOM操作が混入）。
- 対処：正常版の `renderBasicSummary()` に戻す（READMEの注意点参照）。

(2) 国旗ピン／国ボタン／制度表が全部出ない
- 原因：JSが途中で例外停止、または `file://` 直開きで `fetch(./data/*.csv)` が失敗。
- 対処：ローカルHTTPサーバ（またはGitHub Pages）で開き、DevTools Console を確認。

(3) キャッシュで JS が反映されない
- `index.html` / `country.html` の script 読み込みに `?v=yyyymmdd` を付与（Networkで app.js Response を確認）。

【5. 次の作業】
- 次は C01〜C03（別チャットで実施予定）。
- 進め方：定義固定 → 出典URLは JSON配列文字列 → `version=2026/2/4` & `review_status=published` の整合維持。