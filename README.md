# デジタルID制度 国際比較データベース
（📌 このREADMEは **AIプロンプト** を兼ねています）
---

## ⚠️ IMPORTANT — AI PROMPT NOTICE
**このREADMEは、単なる説明書ではありません。**

本READMEは、

- 本リポジトリの仕様書
- 運用ルール
- 設計思想の宣言
- **AI（Copilot / ChatGPT 等）に与える前提条件・制約（プロンプト）**

を **同時に満たす文書**として設計されています。

👉 新しいチャットを開始した場合でも、  
👉 **このREADME全文をAIに提示することで、同一の前提・制約・思想を共有できます。**

AIは、このREADMEを  
**「このプロジェクトにおける憲法」**として扱ってください。

---

## 1. プロジェクトの目的（WHY）
本リポジトリは、日本を基準に主要国の  
**デジタルID制度の「設計思想・制度構造の違い」**を比較するための  
**データ駆動型・完全静的な可視化データベース & Webサイト**です。

- 制度の「優劣」を評価・断定することは目的としません
- 「なぜその制度が、そう設計されたのか」という  
  **背景・構造・選択理由の違い**を理解することを重視します

想定読者：

- 政策担当者
- 研究者
- 行政・GovTech開発者

---

## 2. 最重要原則（ABSOLUTE RULES / PROMPT CORE）
以下は **絶対に破ってはいけない制約** です。  
AIは、本プロジェクトに関与する際、必ずこれを最優先してください。

### ✅ CSV is Source of Truth
- **CSVが唯一の正（Source of Truth）**
- CSVの内容を **解釈・補正・推測・要約・言い換えしない**
- 欠損値を推測で埋めない

### ✅ JavaScriptの役割制限
- JavaScript（app.js）は **CSV → UI変換のみ**
- 以下を **追加・提案してはならない**
  - 国別例外ロジック
  - 自動計算
  - 翻訳推測
  - 地図投影・補正ロジック

### ✅ 指標は固定
- 指標は **I01〜I11の11項目で固定**
- 数・順序・意味を絶対に変更しない
- 表示順は `indicators.csv` の `display_order` を最優先

### ✅ 完全静的
- GitHub Pages / ローカルHTTPサーバで動作
- 外部API・外部CDN・外部地図サービスに依存しない
- ※例外：国旗画像はブラウザ互換性のため FlagCDN（外部CDN）を使用する（将来 assets 化を検討）

### ✅ 見た目はCSSのみ
- UIの調整は **CSS（styles.css / theme.css）のみ**
- HTML構造やJSロジックでの見た目調整は禁止

---

## 3. 可視化の基本方針（WHAT）
AIは、このサイトを  
**「データを評価するUI」ではなく「データを可視化するUI」**として扱ってください。

- 表示対象：
  - `country_indicator.csv` の  
    **(version, review_status="published")** フィルタ結果のみ

- `value` 表示ルール：
  - main：原文のまま表示（英語）
  - detail：
    - `translations_ja.csv` に **完全一致** した場合のみ日本語に置換
    - 一致しない場合は原文表示（推測翻訳禁止）

---

## 4. 世界地図と国旗ピンのルール（重要）

### 4.1 地図の表示方式
- 世界地図は **CSS の `background-image`** として表示する
- 現在は **PNG 画像のみを使用**
  - SVG は未使用（将来追加の可能性はあるが前提にしない）
- 使用している PNG は **日本中心（Japan-centered）に編集された世界地図**
- 一般的な経緯度（Greenwich-centered）とは一致しない

### 4.2 国旗ピン位置の Source of Truth
- 国旗ピン位置の **唯一の正（SoT）は `countries.csv`**
- 使用カラム：
  - `map_lat`
  - `map_lon`
  - `map_dx`
  - `map_dy`

これらの値は：
- 実世界の正確な緯度・経度ではない
- 日本中心の地図画像に合わせて **人間が手動で調整するための座標**である

### 4.3 国追加時の正式ルール
- 新しい国を追加する場合：
  1. `countries.csv` に国を追加
  2. 地図画像を見ながら `map_lat` / `map_lon`（必要なら `map_dx` / `map_dy`）を手動調整
- JavaScriptで：
  - 自動緯度経度変換
  - 投影計算
  - 国別補正テーブル
  を **追加してはならない**

---

## 5. 比較UIに関する運用ルール（追加）

### 5.1 基準国（Baseline）
- 比較の基準国は **日本（country_id="JPN"）**
- 日本は **常に比較対象に含まれる（非表示にできない）**
- 比較表では **日本列を常に左端に固定**する

### 5.2 国選択（chips）の扱い
- 国選択UI（chips）では、日本（JPN）を **表示しない**
- 比較対象の選択は「日本と比較する相手国」を選ぶUIとする
- 「すべて解除」操作は、日本（JPN）のみが残る挙動とする

### 5.3 初期表示（デフォルト選択）
- 初期表示の国は以下とする：
  - JPN, EST, DNK, KOR

※ 本章は UI の挙動を固定するための運用ルールであり、CSVの内容を変更・推測するものではない。

---

## 6. 翻訳CSV（translations_ja.csv）の厳格ルール（追加）
`translations_ja.csv` は、detail日本語置換の **唯一の辞書**である。

- ファイルパス：`data/translations_ja.csv`
- ヘッダは **必ず `en,ja`**
  - ヘッダ名が異なる場合、辞書化されず翻訳が適用されない
- 置換条件：
  - `en` 列に **完全一致** した場合のみ `ja` に置換
  - 一致しない場合は原文（英語）を表示（推測翻訳禁止）

---

## 7. フォルダ構成
```text
digital-id-db/
├─ assets/
├─ data/
│  ├─ countries.csv
│  ├─ indicators.csv
│  ├─ country_indicator.csv
│  ├─ translations_ja.csv
│  └─ events.csv
│
├─ index.html
├─ country.html
├─ app.js
├─ styles.css
├─ theme.css
└─ README.md

---

## 8. CSV保存時の注意（重要）
CSVは必ず UTF-8（BOM付き） で保存すること。
（Excelでは「CSV UTF-8（コンマ区切り）」で保存しないと、Web表示で文字化けします）

---

## 9. 新しい国を追加する際のチェックリスト
1.countries.csv に国を追加する
2.日本中心地図PNGを見ながら map_lat / map_lon（必要なら map_dx / map_dy）を手動調整
3.JavaScriptには一切手を入れない

---

## 10. AIへの行動指針（HOW TO RESPOND）
AIは、本リポジトリに関する質問・修正提案に対して：
・最小変更を前提に提案すること
・触るファイル名・箇所を明示すること
・制約に抵触しない理由を必ず一言で添えること
・判断に迷う場合は、勝手に決めず質問を返すこと

---

## 11. 最後に
このREADMEは、
・仕様書
・運用ルール
・設計憲法
・AIプロンプト
を兼ねています。
AIは、このREADMEを「このプロジェクトに参加する前に必ず読む前提条件」として扱ってください。